<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• DEBUG LIVE SITE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .error { color: #ff6b6b; background: #2a1a1a; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { color: #51cf66; background: #1a2a1a; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { color: #74c0fc; background: #1a1a2a; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .btn { padding: 12px 24px; margin: 8px; background: #ff4444; color: white; border: none; border-radius: 6px; cursor: pointer; }
        h1 { color: #ff4444; text-align: center; }
        .log { background: #2a2a2a; padding: 10px; border-radius: 5px; margin: 5px 0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• DEBUG LIVE SITE ISSUES</h1>
        
        <button class="btn" onclick="debugEverything()">üîç DEBUG EVERYTHING</button>
        <button class="btn" onclick="testDirectESPN()">üì° TEST ESPN DIRECT</button>
        <button class="btn" onclick="testProxy()">üîß TEST PROXY</button>
        <button class="btn" onclick="testNCAAService()">üèà TEST NCAA SERVICE</button>
        
        <div id="debug-output"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('debug-output');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        async function debugEverything() {
            log('üî• STARTING COMPLETE DEBUG...', 'info');
            
            // Clear previous output
            document.getElementById('debug-output').innerHTML = '';
            
            // Test 1: Check if scripts are loading
            log('1Ô∏è‚É£ Checking script availability...', 'info');
            
            const scripts = [
                'error-handler.js',
                'cache-manager.js', 
                'data-validator.js',
                'loading-state-manager.js',
                'ncaa-data-service.js'
            ];
            
            for (const script of scripts) {
                try {
                    const response = await fetch(`/public/${script}`);
                    if (response.ok) {
                        log(`‚úÖ ${script} - Available (${response.status})`, 'success');
                    } else {
                        log(`‚ùå ${script} - Failed (${response.status})`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå ${script} - Error: ${error.message}`, 'error');
                }
            }
            
            // Test 2: Check if NCAA service exists
            log('2Ô∏è‚É£ Checking NCAA Data Service...', 'info');
            
            if (typeof NCAADataService !== 'undefined') {
                log('‚úÖ NCAADataService class is available', 'success');
                
                try {
                    const service = new NCAADataService();
                    log('‚úÖ NCAA service instantiated successfully', 'success');
                    
                    // Test the service
                    log('üîç Testing getTodaysGames method...', 'info');
                    const games = await service.getTodaysGames();
                    log(`üìä Got ${games ? games.length : 0} games`, games && games.length > 0 ? 'success' : 'error');
                    
                    if (games && games.length > 0) {
                        const firstGame = games[0];
                        log(`üèà First game: ${firstGame.name}`, 'info');
                        log(`üìç Venue: ${firstGame.venue}`, 'info');
                        log(`üî¥ Is Live: ${firstGame.isLive}`, firstGame.isLive ? 'success' : 'info');
                        
                        if (firstGame.liveBettingOdds) {
                            log('üí∞ Has betting odds', 'success');
                        }
                        
                        if (firstGame.aiPrediction) {
                            log('üß† Has AI prediction', 'success');
                        }
                    }
                    
                } catch (error) {
                    log(`‚ùå NCAA service error: ${error.message}`, 'error');
                    console.error('NCAA Service Error:', error);
                }
            } else {
                log('‚ùå NCAADataService class not found', 'error');
            }
            
            // Test 3: Check proxy
            await testProxy();
            
            // Test 4: Check ESPN direct
            await testDirectESPN();
        }

        async function testDirectESPN() {
            log('üì° Testing ESPN API directly...', 'info');
            
            try {
                const espnUrl = 'https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard';
                const proxyUrl = `/api/proxy?url=${encodeURIComponent(espnUrl)}`;
                
                log(`üîó Proxy URL: ${proxyUrl}`, 'info');
                
                const response = await fetch(proxyUrl);
                log(`üìä Response status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`üìä Response type: ${typeof data}`, 'info');
                    log(`üìä Has events: ${!!(data && data.events)}`, 'info');
                    
                    if (data && data.events) {
                        log(`üìä Events count: ${data.events.length}`, 'success');
                        
                        if (data.events.length > 0) {
                            const event = data.events[0];
                            log(`üèà First event: ${event.name}`, 'info');
                            log(`üî¥ Is live: ${event.status?.type?.name === 'STATUS_IN_PROGRESS'}`, 'info');
                        }
                    }
                } else {
                    const errorText = await response.text();
                    log(`‚ùå ESPN Error: ${errorText}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå ESPN Test Error: ${error.message}`, 'error');
            }
        }

        async function testProxy() {
            log('üîß Testing proxy functionality...', 'info');
            
            try {
                const testUrl = 'https://httpbin.org/json';
                const proxyUrl = `/api/proxy?url=${encodeURIComponent(testUrl)}`;
                
                const response = await fetch(proxyUrl);
                log(`üîß Proxy test status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Proxy is working correctly', 'success');
                } else {
                    log('‚ùå Proxy is not working', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Proxy test error: ${error.message}`, 'error');
            }
        }

        async function testNCAAService() {
            log('üèà Testing NCAA Service in isolation...', 'info');
            
            // Try to load the NCAA service script directly
            try {
                if (typeof NCAADataService === 'undefined') {
                    log('‚ö†Ô∏è Loading NCAA Data Service script...', 'info');
                    
                    // Load required scripts in order
                    const scriptsToLoad = [
                        '/public/error-handler.js',
                        '/public/cache-manager.js',
                        '/public/data-validator.js', 
                        '/public/loading-state-manager.js',
                        '/public/ncaa-data-service.js'
                    ];
                    
                    for (const scriptUrl of scriptsToLoad) {
                        await loadScript(scriptUrl);
                        log(`üìú Loaded: ${scriptUrl}`, 'success');
                    }
                }
                
                if (typeof NCAADataService !== 'undefined') {
                    log('‚úÖ NCAA Data Service is now available', 'success');
                    
                    const service = new NCAADataService();
                    const games = await service.getTodaysGames();
                    
                    log(`üéØ Final result: ${games ? games.length : 0} games`, 'success');
                    
                    if (games && games.length > 0) {
                        games.forEach((game, index) => {
                            log(`üèà Game ${index + 1}: ${game.name} ${game.isLive ? 'üî¥ LIVE' : ''}`, 'info');
                        });
                    }
                } else {
                    log('‚ùå Still cannot load NCAA Data Service', 'error');
                }
                
            } catch (error) {
                log(`‚ùå NCAA Service test error: ${error.message}`, 'error');
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Auto-run debug on page load
        window.addEventListener('load', function() {
            setTimeout(debugEverything, 1000);
        });
    </script>
</body>
</html>