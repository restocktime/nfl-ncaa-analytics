<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://api.sleeper.app https://fantasysports.yahooapis.com https://lm-api-reads.fantasy.espn.com https://site.api.espn.com https://api.espn.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://use.fontawesome.com https://fonts.googleapis.com https://fonts.gstatic.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://use.fontawesome.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com https://use.fontawesome.com; img-src 'self' data: https: blob:;">
    <title>Site Status Check - API & Icons</title>
    
    <!-- Font Awesome with multiple fallbacks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" media="print" onload="this.media='all'">
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1b3a 100%);
            color: #f8fafc;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(30, 30, 63, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            background: rgba(30, 30, 63, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .test-section h3 {
            color: #6366f1;
            margin: 0 0 15px 0;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            transform: translateY(-1px);
        }
        
        .test-btn:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
            border: 1px solid;
        }
        
        .status.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }
        
        .status.info {
            background: rgba(99, 102, 241, 0.1);
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .icon-test {
            font-size: 24px;
            margin: 0 10px;
            display: inline-block;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 63, 0.9);
            backdrop-filter: blur(20px);
            color: #f8fafc;
            padding: 12px 20px;
            text-decoration: none;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }
        
        /* Icon fallbacks */
        .fas.fa-football-ball:before { content: "üèà"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-chart-line:before { content: "üìà"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-users:before { content: "üë•"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-rocket:before { content: "üöÄ"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-cog:before { content: "‚öôÔ∏è"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-check:before { content: "‚úÖ"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-times:before { content: "‚ùå"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
        .fas.fa-wifi:before { content: "üì∂"; font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif; }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">‚Üê Back to Main Site</a>
    
    <div class="container">
        <div class="header">
            <h1>üîß Site Status Check</h1>
            <p>Test API connections and icon loading on deployed site</p>
        </div>
        
        <div class="test-section">
            <h3><i class="fas fa-wifi"></i> Icon Loading Test</h3>
            <p>These icons should display as symbols, not boxes:</p>
            <div style="font-size: 32px; margin: 20px 0; text-align: center;">
                <i class="fas fa-football-ball icon-test"></i>
                <i class="fas fa-chart-line icon-test"></i>
                <i class="fas fa-users icon-test"></i>
                <i class="fas fa-rocket icon-test"></i>
                <i class="fas fa-cog icon-test"></i>
                <i class="fas fa-check icon-test"></i>
                <i class="fas fa-times icon-test"></i>
            </div>
            <button class="test-btn" onclick="testIconLoading()">üß™ Test Icon Loading</button>
            <div id="iconResults"></div>
        </div>
        
        <div class="test-section">
            <h3><i class="fas fa-chart-line"></i> Fantasy API Connection Test</h3>
            <p>Test if fantasy APIs work on the deployed site:</p>
            <button class="test-btn" onclick="testSleeperAPI()" id="sleeperBtn">Test Sleeper API</button>
            <button class="test-btn" onclick="testESPNAPI()" id="espnBtn">Test ESPN API</button>
            <button class="test-btn" onclick="testAllAPIs()" id="allBtn">Test All APIs</button>
            <div id="apiResults"></div>
        </div>
        
        <div class="test-section">
            <h3><i class="fas fa-cog"></i> Browser Environment Check</h3>
            <button class="test-btn" onclick="checkEnvironment()">Check Browser Info</button>
            <div id="envResults"></div>
        </div>
        
        <div class="test-section">
            <h3><i class="fas fa-rocket"></i> Quick Links</h3>
            <a href="fantasy-hub.html" class="test-btn">üèà Fantasy Hub</a>
            <a href="connect-accounts.html" class="test-btn">üîó Connect Accounts</a>
            <a href="api-test.html" class="test-btn">üß™ API Test Page</a>
        </div>
    </div>
    
    <script>
        console.log('üîß Site Status Check loaded');
        
        // Test icon loading
        function testIconLoading() {
            const results = document.getElementById('iconResults');
            results.innerHTML = '<div class="status info">Testing icon loading...</div>';
            
            // Check if Font Awesome is loaded
            const testElement = document.createElement('i');
            testElement.className = 'fas fa-home';
            testElement.style.position = 'absolute';
            testElement.style.left = '-9999px';
            document.body.appendChild(testElement);
            
            setTimeout(() => {
                const computed = window.getComputedStyle(testElement, ':before');
                const content = computed.content;
                const fontFamily = computed.fontFamily;
                
                const isFontAwesome = fontFamily.includes('Font Awesome') || 
                                    (content !== 'none' && content !== '""' && content.length > 3);
                
                let html = '';
                if (isFontAwesome) {
                    html = '<div class="status success">‚úÖ Font Awesome loaded successfully - Icons should display properly</div>';
                } else {
                    html = '<div class="status error">‚ùå Font Awesome failed to load - You may see boxes instead of icons</div>';
                    html += '<div class="status info">üí° This page has emoji fallbacks, but other pages may not</div>';
                }
                
                // Check CSP settings
                const csp = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                if (csp) {
                    html += '<div class="status info">üìã CSP headers configured for font loading</div>';
                } else {
                    html += '<div class="status error">‚ö†Ô∏è No CSP headers found</div>';
                }
                
                results.innerHTML = html;
                document.body.removeChild(testElement);
            }, 200);
        }
        
        // Test Sleeper API
        async function testSleeperAPI() {
            const btn = document.getElementById('sleeperBtn');
            const results = document.getElementById('apiResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing Sleeper...';
            
            try {
                const response = await fetch('https://api.sleeper.app/v1/user/testuser123');
                
                if (response.ok || response.status === 404) {
                    results.innerHTML += '<div class="status success">‚úÖ Sleeper API: Connection successful (API accessible)</div>';
                } else {
                    results.innerHTML += `<div class="status error">‚ùå Sleeper API: HTTP ${response.status} - ${response.statusText}</div>`;
                }
            } catch (error) {
                results.innerHTML += `<div class="status error">‚ùå Sleeper API: ${error.message}</div>`;
                
                if (error.message.includes('CSP') || error.message.includes('Content Security Policy')) {
                    results.innerHTML += '<div class="status info">üí° This appears to be a CSP issue - check console for details</div>';
                }
            }
            
            btn.disabled = false;
            btn.textContent = 'Test Sleeper API';
        }
        
        // Test ESPN API
        async function testESPNAPI() {
            const btn = document.getElementById('espnBtn');
            const results = document.getElementById('apiResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing ESPN...';
            
            try {
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
                
                if (response.ok) {
                    results.innerHTML += '<div class="status success">‚úÖ ESPN API: Connection successful</div>';
                } else {
                    results.innerHTML += `<div class="status error">‚ùå ESPN API: HTTP ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML += `<div class="status error">‚ùå ESPN API: ${error.message}</div>`;
            }
            
            btn.disabled = false;
            btn.textContent = 'Test ESPN API';
        }
        
        // Test all APIs
        async function testAllAPIs() {
            const btn = document.getElementById('allBtn');
            const results = document.getElementById('apiResults');
            
            btn.disabled = true;
            btn.textContent = 'Testing All APIs...';
            results.innerHTML = '<div class="status info">üîÑ Testing all API connections...</div>';
            
            const apis = [
                { name: 'Sleeper', url: 'https://api.sleeper.app/v1/user/testuser123' },
                { name: 'ESPN NFL', url: 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard' },
                { name: 'ESPN Fantasy', url: 'https://lm-api-reads.fantasy.espn.com/apis/v3/games/ffl/seasons/2024' }
            ];
            
            let html = '';
            for (const api of apis) {
                try {
                    const response = await fetch(api.url);
                    
                    if (response.ok || response.status === 404) {
                        html += `<div class="status success">‚úÖ ${api.name}: Connection successful</div>`;
                    } else {
                        html += `<div class="status error">‚ùå ${api.name}: HTTP ${response.status}</div>`;
                    }
                } catch (error) {
                    html += `<div class="status error">‚ùå ${api.name}: ${error.message}</div>`;
                    
                    if (error.message.includes('CSP')) {
                        html += `<div class="status info">üí° ${api.name}: CSP blocking detected</div>`;
                    }
                }
            }
            
            results.innerHTML = html;
            
            btn.disabled = false;
            btn.textContent = 'Test All APIs';
        }
        
        // Check browser environment
        function checkEnvironment() {
            const results = document.getElementById('envResults');
            
            let html = '<div class="status info">üìã Browser Environment:</div>';
            html += `<p><strong>User Agent:</strong> ${navigator.userAgent}</p>`;
            html += `<p><strong>URL:</strong> ${window.location.href}</p>`;
            html += `<p><strong>Protocol:</strong> ${window.location.protocol}</p>`;
            html += `<p><strong>Host:</strong> ${window.location.host}</p>`;
            
            // Check if we're on localhost vs deployed
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                html += '<div class="status info">üè† Running on localhost</div>';
            } else {
                html += '<div class="status success">üåê Running on deployed site</div>';
            }
            
            // Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                html += '<div class="status success">‚úÖ localStorage available</div>';
            } catch (e) {
                html += '<div class="status error">‚ùå localStorage blocked</div>';
            }
            
            // Check console for errors
            html += '<div class="status info">üîç Check browser console (F12) for any CSP or loading errors</div>';
            
            results.innerHTML = html;
        }
        
        // Auto-run basic checks on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Auto-running status checks...');
            setTimeout(testIconLoading, 500);
        });
    </script>
</body>
</html>