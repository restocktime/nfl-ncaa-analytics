<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug API Loading</title>
    
    <!-- Allow Vercel proxy connections -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://sleeper-api-proxy.vercel.app; connect-src 'self' https://sleeper-api-proxy.vercel.app; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f0f23;
            color: white;
            padding: 20px;
        }
        .debug-box {
            background: #2d3748;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #10b981;
        }
        .error { border-left-color: #ef4444; }
        button {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>üîç Debug API Loading</h1>
    
    <div class="debug-box">
        <h3>Step 1: Check Script Loading</h3>
        <button onclick="checkScriptLoading()">Check What's Loaded</button>
        <div id="scriptResult"></div>
    </div>
    
    <div class="debug-box">
        <h3>Step 2: Test Direct API Call</h3>
        <button onclick="testDirectAPI()">Test Vercel Proxy Directly</button>
        <div id="apiResult"></div>
    </div>
    
    <div class="debug-box">
        <h3>Step 3: Test Import Function</h3>
        <button onclick="testImportFunction()">Test Import Function</button>
        <div id="importResult"></div>
    </div>
    
    <!-- Try loading the script -->
    <script>
        console.log('üîç Debug script started');
        
        function checkScriptLoading() {
            const resultDiv = document.getElementById('scriptResult');
            let html = '<strong>Debug Info:</strong><br>';
            
            // Check what's in window
            html += `window.FantasyAPIIntegration: ${typeof window.FantasyAPIIntegration}<br>`;
            html += `window.fantasyAPIIntegration: ${typeof window.fantasyAPIIntegration}<br>`;
            
            // List all window properties that might be related
            const related = Object.keys(window).filter(key => 
                key.toLowerCase().includes('fantasy') || 
                key.toLowerCase().includes('api') ||
                key.toLowerCase().includes('sleeper')
            );
            html += `Related window properties: ${related.join(', ')}<br>`;
            
            // Check if script tag exists
            const scriptTag = document.querySelector('script[src*="fantasy-api"]');
            html += `Script tag found: ${!!scriptTag}<br>`;
            if (scriptTag) {
                html += `Script src: ${scriptTag.src}<br>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        async function testDirectAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = 'Testing direct API call...<br>';
            
            try {
                const response = await fetch('https://sleeper-api-proxy.vercel.app/api/sleeper/user/restocktime');
                const text = await response.text();
                
                resultDiv.innerHTML += `Status: ${response.status}<br>`;
                resultDiv.innerHTML += `Response length: ${text.length}<br>`;
                resultDiv.innerHTML += `Response start: ${text.substring(0, 100)}...<br>`;
                
                if (response.ok) {
                    try {
                        const json = JSON.parse(text);
                        resultDiv.innerHTML += `‚úÖ JSON parsed successfully<br>`;
                        resultDiv.innerHTML += `User ID: ${json.user_id}<br>`;
                    } catch (e) {
                        resultDiv.innerHTML += `‚ùå JSON parse failed: ${e.message}<br>`;
                    }
                }
            } catch (error) {
                resultDiv.innerHTML += `‚ùå Fetch failed: ${error.message}<br>`;
            }
        }
        
        async function testImportFunction() {
            const resultDiv = document.getElementById('importResult');
            
            // Try to create our own instance
            resultDiv.innerHTML = 'Attempting to create API instance...<br>';
            
            try {
                // Check if we can access the class
                if (typeof window.FantasyAPIIntegration === 'function') {
                    const api = new window.FantasyAPIIntegration();
                    resultDiv.innerHTML += '‚úÖ Created new API instance<br>';
                    
                    // Test the method directly
                    resultDiv.innerHTML += 'Testing getSleeperLeagueRoster method...<br>';
                    
                    try {
                        const result = await api.getSleeperLeagueRoster('test_league_id', 'test_user_id');
                        resultDiv.innerHTML += '‚úÖ Method executed (even if it failed, no syntax errors)<br>';
                    } catch (error) {
                        resultDiv.innerHTML += `Method error (expected): ${error.message}<br>`;
                    }
                    
                } else {
                    resultDiv.innerHTML += '‚ùå FantasyAPIIntegration class not available<br>';
                    
                    // Try to load it manually
                    resultDiv.innerHTML += 'Attempting to load script manually...<br>';
                    const script = document.createElement('script');
                    script.src = 'fantasy-api-integration.js';
                    script.onload = () => {
                        resultDiv.innerHTML += '‚úÖ Script loaded manually<br>';
                        setTimeout(() => {
                            if (window.FantasyAPIIntegration) {
                                resultDiv.innerHTML += '‚úÖ FantasyAPIIntegration now available<br>';
                            } else {
                                resultDiv.innerHTML += '‚ùå Still not available after manual load<br>';
                            }
                        }, 100);
                    };
                    script.onerror = () => {
                        resultDiv.innerHTML += '‚ùå Script failed to load manually<br>';
                    };
                    document.head.appendChild(script);
                }
            } catch (error) {
                resultDiv.innerHTML += `‚ùå Error: ${error.message}<br>`;
            }
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(checkScriptLoading, 500);
        });
    </script>
</body>
</html>