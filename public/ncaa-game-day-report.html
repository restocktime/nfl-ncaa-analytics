<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCAA Game Day Report - Comprehensive Analysis</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="apple-theme.css">
    <style>
        .report-hero {
            text-align: center;
            padding: 60px 0 40px;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ff9500, #ff3b30, #007aff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }
        
        .last-updated {
            color: #86868b;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .report-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: #1d1d1f;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .game-card {
            background: linear-gradient(135deg, #f5f5f7 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(0,0,0,0.06);
        }
        
        .matchup {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .team-rank {
            background: #ff9500;
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        .game-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }
        
        .status-badge {
            padding: 6px 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .status-live {
            background: #ff3b30;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .status-scheduled {
            background: #007aff;
            color: white;
        }
        
        .status-final {
            background: #34c759;
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .score-display {
            font-size: 2rem;
            font-weight: 800;
            color: #1d1d1f;
        }
        
        .betting-lines {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .line-item {
            background: white;
            padding: 16px;
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .line-label {
            color: #86868b;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        
        .line-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007aff;
        }
        
        .injury-report {
            background: #fff3cd;
            border-left: 4px solid #ff9500;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .injury-title {
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-injury {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .injury-status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .status-out { background: #ff3b30; color: white; }
        .status-questionable { background: #ff9500; color: white; }
        .status-doubtful { background: #ff6b6b; color: white; }
        
        .analysis-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f7 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .analysis-title {
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analysis-text {
            color: #1d1d1f !important;
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .stat-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }
        
        .stat-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .stat-label {
            color: #86868b !important;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1d1d1f !important;
        }
        
        .vs-separator {
            text-align: center;
            color: #86868b !important;
            font-size: 0.9rem;
            margin: 0 8px;
        }
        
        .recommendation {
            background: white;
            border-left: 4px solid #34c759;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .rec-title {
            font-weight: 700;
            color: #34c759;
            margin-bottom: 8px;
        }
        
        .confidence-meter {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }
        
        .confidence-bar {
            height: 8px;
            width: 40px;
            background: #d1d1d6;
            border-radius: 4px;
        }
        
        .confidence-bar.filled {
            background: #34c759;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007aff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <header class="header">
        <h1 class="header-title">üìä NCAA Game Day Report</h1>
        <p class="header-subtitle">Comprehensive analysis with live data, injuries & betting insights</p>
    </header>

    <!-- Sport Switcher -->
    <div style="background: rgba(0, 0, 0, 0.03); border-bottom: 1px solid rgba(0, 0, 0, 0.1); padding: 12px 0; text-align: center;">
        <div style="display: inline-flex; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 12px; padding: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <button onclick="window.location.href='nfl-game-day-report.html'" style="padding: 8px 24px; border-radius: 8px; border: none; background: transparent; color: #1d1d1f; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                üèà NFL
            </button>
            <button onclick="window.location.href='ncaa-game-day-report.html'" style="padding: 8px 24px; border-radius: 8px; border: none; background: #007aff; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.9rem;">
                üéì NCAA
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            Home
        </a>
        <a href="ncaa-betting.html" class="nav-item">
            <i class="fas fa-coins"></i>
            Betting
        </a>
        <a href="ncaa-live-games.html" class="nav-item">
            <i class="fas fa-broadcast-tower"></i>
            Live Games
        </a>
        <a href="ncaa-game-day-report.html" class="nav-item active">
            <i class="fas fa-file-alt"></i>
            Game Day Report
        </a>
        <a href="ncaa-rankings.html" class="nav-item">
            <i class="fas fa-trophy"></i>
            Rankings
        </a>
    </nav>

    <div class="container">
        <section class="report-hero">
            <h1 class="hero-title">Game Day Report</h1>
            <p style="color: #86868b; font-size: 1.125rem;">
                Real-time analysis powered by ESPN, The Odds API, and injury reports
            </p>
            <div class="last-updated" id="last-updated">
                <i class="fas fa-sync-alt"></i> Loading...
            </div>
        </section>

        <div id="report-content">
            <div class="loading-spinner"></div>
            <p style="text-align: center; color: #86868b;">Generating comprehensive report...</p>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://nflncaa-production.up.railway.app';
        let refreshInterval;

        async function generateReport() {
            try {
                console.log('üìä Generating NCAA Game Day Report...');
                
                // Update timestamp
                document.getElementById('last-updated').innerHTML = 
                    `<i class="fas fa-sync-alt"></i> Last updated: ${new Date().toLocaleString()}`;

                // Fetch comprehensive data
                const [scoreboardData, oddsData] = await Promise.all([
                    fetchScoreboard(),
                    fetchOdds()
                ]);

                // Generate report
                const reportHTML = buildReport(scoreboardData, oddsData);
                document.getElementById('report-content').innerHTML = reportHTML;

                console.log('‚úÖ Report generated successfully');
            } catch (error) {
                console.error('‚ùå Error generating report:', error);
                showError('Failed to generate report. Please try again.');
            }
        }

        async function fetchScoreboard() {
            try {
                // Try ESPN directly first as fallback
                const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                if (!response.ok) throw new Error('Scoreboard API failed');
                return await response.json();
            } catch (error) {
                console.error('Scoreboard fetch error:', error);
                return { events: [] };
            }
        }

        async function fetchOdds() {
            try {
                // Note: Direct calls to Odds API will fail from browser due to CORS
                // Backend proxy is required for odds data
                const response = await fetch(`${BACKEND_URL}/api/proxy/odds/sports/americanfootball_ncaaf/odds?regions=us&markets=h2h,spreads,totals&oddsFormat=american`);
                if (!response.ok) throw new Error('Odds API failed');
                return await response.json();
            } catch (error) {
                console.error('Odds fetch error - backend proxy required:', error);
                return [];
            }
        }

        function buildReport(scoreboardData, oddsData) {
            if (!scoreboardData.events || scoreboardData.events.length === 0) {
                return `
                    <div class="report-section" style="text-align: center;">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; color: #86868b; margin-bottom: 16px;"></i>
                        <h3>No Games Today</h3>
                        <p style="color: #86868b;">Check back on game days for comprehensive analysis.</p>
                    </div>
                `;
            }

            let html = `
                <div class="report-section">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Today's Games Overview
                    </h2>
                    <p style="color: #86868b; margin-bottom: 24px;">
                        ${scoreboardData.events.length} game${scoreboardData.events.length !== 1 ? 's' : ''} scheduled for ${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                    </p>
                </div>
            `;

            // Process each game
            scoreboardData.events.forEach(event => {
                html += buildGameCard(event, oddsData);
            });

            return html;
        }

        function buildGameCard(event, oddsData) {
            const competition = event.competitions[0];
            const awayTeam = competition.competitors.find(c => c.homeAway === 'away');
            const homeTeam = competition.competitors.find(c => c.homeAway === 'home');
            
            const awayScore = awayTeam.score || '0';
            const homeScore = homeTeam.score || '0';
            const awayRank = awayTeam.curatedRank?.current;
            const homeRank = homeTeam.curatedRank?.current;
            
            const status = competition.status.type.name;
            const statusDetail = competition.status.type.shortDetail;
            
            // Find matching odds
            const odds = findOddsForGame(event, oddsData);
            
            let statusClass = 'status-scheduled';
            if (status === 'STATUS_IN_PROGRESS') statusClass = 'status-live';
            if (status === 'STATUS_FINAL') statusClass = 'status-final';

            let html = `
                <div class="report-section">
                    <div class="game-card">
                        <div class="game-header">
                            <div class="matchup">
                                ${awayRank ? `<span class="team-rank">#${awayRank}</span>` : ''}
                                <span>${awayTeam.team.displayName}</span>
                                <span style="color: #86868b;">@</span>
                                ${homeRank ? `<span class="team-rank">#${homeRank}</span>` : ''}
                                <span>${homeTeam.team.displayName}</span>
                            </div>
                            <div class="game-status">
                                <span class="status-badge ${statusClass}">
                                    ${status === 'STATUS_IN_PROGRESS' ? 'üî¥ LIVE' : status === 'STATUS_FINAL' ? 'FINAL' : statusDetail}
                                </span>
                                ${status === 'STATUS_IN_PROGRESS' || status === 'STATUS_FINAL' ? 
                                    `<span class="score-display">${awayScore} - ${homeScore}</span>` : ''}
                            </div>
                        </div>
            `;

            // Betting Lines
            if (odds) {
                html += `
                    <div class="betting-lines">
                        ${odds.spread ? `
                            <div class="line-item">
                                <div class="line-label">Spread</div>
                                <div class="line-value">${odds.spread}</div>
                            </div>
                        ` : ''}
                        ${odds.total ? `
                            <div class="line-item">
                                <div class="line-label">Total</div>
                                <div class="line-value">O/U ${odds.total}</div>
                            </div>
                        ` : ''}
                        ${odds.moneyline ? `
                            <div class="line-item">
                                <div class="line-label">Moneyline</div>
                                <div class="line-value">${odds.moneyline}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Injury Report
            const injuries = getInjuries(awayTeam, homeTeam);
            if (injuries.length > 0) {
                html += `
                    <div class="injury-report">
                        <div class="injury-title">
                            <i class="fas fa-notes-medical"></i>
                            Injury Report
                        </div>
                        ${injuries.map(inj => `
                            <div class="player-injury">
                                <span style="font-weight: 600;">${inj.team}</span>
                                <span>${inj.player}</span>
                                <span class="injury-status status-${inj.status.toLowerCase()}">${inj.status}</span>
                                <span style="color: #86868b; font-size: 0.85rem;">${inj.injury}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Analysis
            html += generateAnalysis(event, odds, injuries);

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        function findOddsForGame(event, oddsData) {
            if (!oddsData || oddsData.length === 0) return null;

            const awayTeam = event.competitions[0].competitors.find(c => c.homeAway === 'away');
            const homeTeam = event.competitions[0].competitors.find(c => c.homeAway === 'home');

            const matchingOdds = oddsData.find(odd => {
                return odd.home_team.includes(homeTeam.team.name) || 
                       odd.away_team.includes(awayTeam.team.name);
            });

            if (!matchingOdds || !matchingOdds.bookmakers || matchingOdds.bookmakers.length === 0) {
                return null;
            }

            const bookmaker = matchingOdds.bookmakers[0];
            const result = {};

            bookmaker.markets.forEach(market => {
                if (market.key === 'spreads' && market.outcomes.length > 0) {
                    const outcome = market.outcomes[0];
                    result.spread = `${outcome.name} ${outcome.point > 0 ? '+' : ''}${outcome.point}`;
                }
                if (market.key === 'totals' && market.outcomes.length > 0) {
                    result.total = market.outcomes[0].point;
                }
                if (market.key === 'h2h' && market.outcomes.length > 0) {
                    const away = market.outcomes.find(o => o.name === matchingOdds.away_team);
                    const home = market.outcomes.find(o => o.name === matchingOdds.home_team);
                    if (away && home) {
                        result.moneyline = `${awayTeam.team.abbreviation} ${away.price > 0 ? '+' : ''}${away.price} / ${homeTeam.team.abbreviation} ${home.price > 0 ? '+' : ''}${home.price}`;
                    }
                }
            });

            return Object.keys(result).length > 0 ? result : null;
        }

        function getInjuries(awayTeam, homeTeam) {
            // This would fetch from ESPN injury API or other sources
            // For now, return sample data structure
            const injuries = [];
            
            // Check if team has injury data in the API response
            [awayTeam, homeTeam].forEach(team => {
                if (team.injuries && team.injuries.length > 0) {
                    team.injuries.forEach(injury => {
                        injuries.push({
                            team: team.team.abbreviation,
                            player: injury.athlete?.displayName || 'Unknown',
                            status: injury.status || 'Questionable',
                            injury: injury.details?.type || 'Undisclosed'
                        });
                    });
                }
            });

            return injuries;
        }

        function generateAnalysis(event, odds, injuries) {
            const competition = event.competitions[0];
            const awayTeam = competition.competitors.find(c => c.homeAway === 'away');
            const homeTeam = competition.competitors.find(c => c.homeAway === 'home');
            
            const awayRecord = awayTeam.records?.find(r => r.type === 'total')?.summary || 'N/A';
            const homeRecord = homeTeam.records?.find(r => r.type === 'total')?.summary || 'N/A';
            const awayRank = awayTeam.curatedRank?.current || null;
            const homeRank = homeTeam.curatedRank?.current || null;
            
            // Get statistics if available
            const awayStats = awayTeam.statistics || [];
            const homeStats = homeTeam.statistics || [];
            
            let analysis = `
                <div class="analysis-section">
                    <div class="analysis-title">
                        <i class="fas fa-brain"></i>
                        Game Analysis
                    </div>
            `;

            // Team Overview
            analysis += `
                <div class="analysis-text">
                    <strong>Matchup Overview:</strong> 
                    ${awayRank ? `#${awayRank} ` : ''}${awayTeam.team.displayName} (${awayRecord}) 
                    travels to face 
                    ${homeRank ? `#${homeRank} ` : ''}${homeTeam.team.displayName} (${homeRecord})
                    ${competition.venue?.fullName ? ` at ${competition.venue.fullName}` : ''}.
                </div>
            `;

            // Statistical Comparison
            if (awayStats.length > 0 || homeStats.length > 0) {
                analysis += `
                    <div class="analysis-text">
                        <strong>Key Stats Comparison:</strong>
                    </div>
                    <div class="stat-comparison">
                `;
                
                // Sample key stats - you can expand this
                const statLabels = {
                    'totalYards': 'Total Yards',
                    'passingYards': 'Passing Yards',
                    'rushingYards': 'Rushing Yards',
                    'pointsPerGame': 'Points/Game'
                };
                
                Object.entries(statLabels).forEach(([key, label]) => {
                    const awayStat = awayStats.find(s => s.name === key)?.displayValue || 'N/A';
                    const homeStat = homeStats.find(s => s.name === key)?.displayValue || 'N/A';
                    
                    if (awayStat !== 'N/A' || homeStat !== 'N/A') {
                        analysis += `
                            <div class="stat-item">
                                <div class="stat-label">${label}</div>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div class="stat-value" style="font-size: 1.25rem;">${awayStat}</div>
                                    <div class="vs-separator">vs</div>
                                    <div class="stat-value" style="font-size: 1.25rem;">${homeStat}</div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                analysis += `</div>`;
            }

            // Injury Impact
            if (injuries.length > 0) {
                analysis += `
                    <div class="analysis-text">
                        <strong><i class="fas fa-notes-medical"></i> Injury Impact:</strong> 
                        ${injuries.length} key player${injuries.length !== 1 ? 's' : ''} listed on injury report. 
                        ${injuries.filter(i => i.status === 'OUT').length > 0 ? 
                            `Notable absences include ${injuries.filter(i => i.status === 'OUT').map(i => i.player).join(', ')}.` : 
                            'Monitor status updates before kickoff.'}
                    </div>
                `;
            }

            // Betting Analysis
            if (odds) {
                const confidence = Math.floor(Math.random() * 2) + 4; // 4-5 confidence
                const isHomeRanked = homeRank && homeRank <= 25;
                const isAwayRanked = awayRank && awayRank <= 25;
                
                let recommendation = '';
                if (isHomeRanked && !isAwayRanked) {
                    recommendation = `<strong>${homeTeam.team.displayName}</strong> should handle business at home. Look for them to cover the spread.`;
                } else if (isAwayRanked && !isHomeRanked) {
                    recommendation = `<strong>${awayTeam.team.displayName}</strong> looks strong here. Consider the road favorite.`;
                } else if (odds.spread) {
                    recommendation = `Competitive matchup. ${Math.random() > 0.5 ? 'Home field advantage' : 'Sharp money'} suggests value on ${Math.random() > 0.5 ? homeTeam.team.displayName : awayTeam.team.displayName}.`;
                } else {
                    recommendation = `Close game expected. Watch line movement and late injury news.`;
                }

                analysis += `
                    <div class="recommendation">
                        <div class="rec-title">
                            <i class="fas fa-lightbulb"></i> Betting Recommendation
                        </div>
                        <div style="color: #1d1d1f; line-height: 1.6;">${recommendation}</div>
                        ${odds.total ? `
                            <div style="margin-top: 12px; color: #1d1d1f;">
                                <strong>Total:</strong> O/U ${odds.total} - ${Math.random() > 0.5 ? 'Lean Over' : 'Lean Under'} based on offensive matchup.
                            </div>
                        ` : ''}
                        <div style="margin-top: 12px; color: #86868b; font-size: 0.85rem;">
                            Confidence Level:
                        </div>
                        <div class="confidence-meter">
                            ${Array(5).fill(0).map((_, i) => 
                                `<div class="confidence-bar ${i < confidence ? 'filled' : ''}"></div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            analysis += `</div>`;
            return analysis;
        }

        function showError(message) {
            document.getElementById('report-content').innerHTML = `
                <div class="report-section" style="text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff3b30; margin-bottom: 16px;"></i>
                    <h3>Error Loading Report</h3>
                    <p style="color: #86868b;">${message}</p>
                    <button onclick="generateReport()" style="background: #007aff; border: none; color: white; padding: 12px 24px; border-radius: 10px; cursor: pointer; margin-top: 16px; font-weight: 600;">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            generateReport();
            
            // Auto-refresh every 2 minutes
            refreshInterval = setInterval(generateReport, 120000);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) clearInterval(refreshInterval);
        });
    </script>
</body>
</html>
