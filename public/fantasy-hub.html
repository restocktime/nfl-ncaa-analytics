<!DOCTYPE html>
<html>
  <head>
    <title>Fantasy Hub</title>
    <style>
      body {
        background-color: #0a0e1a;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        text-align: center;
        background-color: #1a202c;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
      }
      .header h1 {
        color: #667eea;
        font-size: 2.5rem;
        margin: 0 0 10px 0;
      }
      .nav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .nav-card {
        background-color: #1a202c;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      .nav-card:hover {
        transform: translateY(-5px);
        border-color: #667eea;
      }
      .nav-card h3 {
        color: #667eea;
        font-size: 1.5rem;
        margin: 0 0 15px 0;
      }
      .nav-card p {
        color: #a0aec0;
        margin: 0;
      }
      .back-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #1a202c;
        color: white;
        padding: 15px 20px;
        text-decoration: none;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .back-btn:hover {
        background-color: #667eea;
      }
      .content {
        background-color: #1a202c;
        border-radius: 10px;
        padding: 30px;
        margin-top: 30px;
        display: none;
      }
      .content.active {
        display: block;
      }
      .content h2 {
        color: #667eea;
        font-size: 2rem;
        margin: 0 0 20px 0;
      }
      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }
      .feature-card {
        background-color: #121825;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .feature-card h4 {
        color: #667eea;
        margin: 0 0 10px 0;
      }
      .feature-card p {
        color: #a0aec0;
        margin: 5px 0;
      }
      .status {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background-color: #1a202c;
        padding: 10px 15px;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #4ade80;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back-btn">← Back to NFL Analytics</a>

    <div class="container">
      <div class="header">
        <h1>🏈 Fantasy Football Hub</h1>
        <p>Your complete fantasy football management center</p>
        <div style="margin-top: 20px">
          <a
            href="roster-builder.html"
            style="
              background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
              color: white;
              padding: 15px 30px;
              text-decoration: none;
              border-radius: 10px;
              font-weight: bold;
              display: inline-block;
              margin-right: 15px;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-2px)'"
            onmouseout="this.style.transform='translateY(0)'"
          >
            👥 Build Your Roster
          </a>
          <a
            href="revolutionary-fantasy-hub.html"
            style="
              background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
              color: white;
              padding: 15px 30px;
              text-decoration: none;
              border-radius: 10px;
              font-weight: bold;
              display: inline-block;
              margin-right: 15px;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-2px)'"
            onmouseout="this.style.transform='translateY(0)'"
          >
            🚀 Try Revolutionary Hub
          </a>
          <a
            href="revolutionary-fantasy-demo.html"
            style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 15px 30px;
              text-decoration: none;
              border-radius: 10px;
              font-weight: bold;
              display: inline-block;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-2px)'"
            onmouseout="this.style.transform='translateY(0)'"
          >
            📊 Live Demo
          </a>
        </div>
      </div>

      <div class="nav-grid">
        <div class="nav-card" onclick="showSection('dashboard')">
          <h3>📊 Fantasy Dashboard</h3>
          <p>Overview of your team and weekly performance</p>
        </div>

        <div class="nav-card" onclick="showSection('lineup')">
          <h3>👥 Lineup Optimizer</h3>
          <p>AI-powered lineup recommendations</p>
        </div>

        <div class="nav-card" onclick="showSection('waivers')">
          <h3>🔍 Waiver Wire</h3>
          <p>Smart waiver wire analysis</p>
        </div>

        <div class="nav-card" onclick="showSection('trades')">
          <h3>🔄 Trade Analyzer</h3>
          <p>Advanced trade evaluation</p>
        </div>

        <div class="nav-card" onclick="showSection('projections')">
          <h3>📈 Player Projections</h3>
          <p>ML-powered performance projections</p>
        </div>

        <div class="nav-card" onclick="showSection('roster')">
          <h3>👥 My Roster</h3>
          <p>View and manage your fantasy roster</p>
        </div>

        <div class="nav-card" onclick="showSection('settings')">
          <h3>⚙️ League Setup</h3>
          <p>Configure your league settings</p>
        </div>
      </div>

      <div id="dashboard" class="content">
        <h2>📊 Fantasy Dashboard</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Loading Your Optimal Lineup...</h4>
            <p>🔄 Fetching your roster data...</p>
          </div>
          <div class="feature-card">
            <h4>This Week's Matchups</h4>
            <p>🔄 Loading matchup data...</p>
          </div>
          <div class="feature-card">
            <h4>Injury Watch</h4>
            <p>🔄 Checking injury reports...</p>
          </div>
          <div class="feature-card">
            <h4>Breaking Fantasy News</h4>
            <p>🔄 Loading latest news...</p>
          </div>
        </div>
      </div>

      <div id="lineup" class="content">
        <h2>👥 Lineup Optimizer</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Your Lineup Analysis</h4>
            <p>🔄 Analyzing your roster...</p>
          </div>
          <div class="feature-card">
            <h4>Lineup Recommendations</h4>
            <p>🔄 Calculating optimal changes...</p>
          </div>
          <div class="feature-card">
            <h4>Risk Analysis</h4>
            <p>🔄 Assessing roster risk...</p>
          </div>
          <div class="feature-card">
            <h4>Your Players This Week</h4>
            <p>🔄 Loading matchup grades...</p>
          </div>
        </div>
      </div>

      <div id="waivers" class="content">
        <h2>🔍 Waiver Wire Intelligence</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Top Waiver Targets</h4>
            <p>🔄 Scanning waiver wire...</p>
          </div>
          <div class="feature-card">
            <h4>Breakout Candidates</h4>
            <p>🔄 Identifying breakout players...</p>
          </div>
          <div class="feature-card">
            <h4>Injury Replacements</h4>
            <p>🔄 Monitoring injury reports...</p>
          </div>
          <div class="feature-card">
            <h4>Trending Up</h4>
            <p>🔄 Analyzing player trends...</p>
          </div>
        </div>
      </div>

      <div id="trades" class="content">
        <h2>🔄 Trade Analyzer</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Trade Opportunities</h4>
            <p>🔄 Analyzing trade opportunities...</p>
          </div>
          <div class="feature-card">
            <h4>Your Player Values</h4>
            <p>🔄 Calculating market values...</p>
          </div>
          <div class="feature-card">
            <h4>Trade Calculator</h4>
            <p>🔄 Loading trade tools...</p>
          </div>
          <div class="feature-card">
            <h4>Trade Tips</h4>
            <p>🔄 Loading trade insights...</p>
          </div>
        </div>
      </div>

      <div id="projections" class="content">
        <h2>📈 Player Projections</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Top QB Projections</h4>
            <p>🔄 Loading QB projections...</p>
          </div>
          <div class="feature-card">
            <h4>Top RB Projections</h4>
            <p>🔄 Loading RB projections...</p>
          </div>
          <div class="feature-card">
            <h4>Top WR Projections</h4>
            <p>🔄 Loading WR projections...</p>
          </div>
          <div class="feature-card">
            <h4>Top TE Projections</h4>
            <p>🔄 Loading TE projections...</p>
          </div>
        </div>
      </div>

      <div id="roster" class="content">
        <h2>👥 My Fantasy Roster</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Starting Lineup</h4>
            <div id="starting-lineup-display">
              <p>Loading your optimal lineup...</p>
            </div>
          </div>
          <div class="feature-card">
            <h4>Bench Players</h4>
            <div id="bench-players-display">
              <p>Loading bench players...</p>
            </div>
          </div>
          <div class="feature-card">
            <h4>Roster Stats</h4>
            <div id="roster-stats-display">
              <p>Calculating roster statistics...</p>
            </div>
          </div>
          <div class="feature-card">
            <h4>Sit/Start Recommendations</h4>
            <div id="sit-start-display">
              <p>Analyzing sit/start decisions...</p>
            </div>
          </div>
        </div>
      </div>

      <div id="settings" class="content">
        <h2>⚙️ League Configuration</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Import League</h4>
            <p>Connect to ESPN, Yahoo, or Sleeper</p>
            <p>Automatic roster sync</p>
            <p>League settings import</p>
            <p>Scoring system detection</p>
          </div>
          <div class="feature-card" id="league-settings-display">
            <h4>League Settings</h4>
            <p>🔄 Loading league configuration...</p>
          </div>
          <div class="feature-card" id="waiver-settings-display">
            <h4>Waiver Settings</h4>
            <p>🔄 Loading waiver rules...</p>
          </div>
          <div class="feature-card" id="playoff-settings-display">
            <h4>Playoff Settings</h4>
            <p>🔄 Loading playoff format...</p>
          </div>
        </div>
      </div>
    </div>

    <div class="status" id="status">Fantasy Hub loaded successfully ✅</div>

    <!-- Load Fantasy Data Service -->
    <script src="fantasy-data-service.js"></script>
    <script src="fantasy-news-service.js"></script>
    <script src="fantasy-roster-manager.js"></script>
    
    <script>
      console.log("Fantasy Hub loaded successfully");

      // Initialize live data when page loads
      let fantasyApp;
      let fantasyNewsApp;
      let fantasyRosterApp;
      
      document.addEventListener('DOMContentLoaded', async function() {
        await initializeLiveData();
        await initializeNewsService();
        await initializeRosterManager();
        loadDashboardData();
        
        // Update data every 5 minutes
        setInterval(loadDashboardData, 5 * 60 * 1000);
        setInterval(loadNewsData, 10 * 60 * 1000);
      });

      async function initializeLiveData() {
        console.log('🏈 Initializing Fantasy Live Data...');
        
        // Wait for fantasy data service to be available
        let attempts = 0;
        while (!window.fantasyDataService && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        if (window.fantasyDataService) {
          fantasyApp = window.fantasyDataService;
          console.log('✅ Fantasy Data Service connected');
        } else {
          console.warn('⚠️ Fantasy Data Service not found, using mock data');
        }
      }

      async function initializeNewsService() {
        console.log('📰 Initializing Fantasy News Service...');
        
        // Wait for fantasy news service to be available
        let attempts = 0;
        while (!window.fantasyNewsService && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        if (window.fantasyNewsService) {
          fantasyNewsApp = window.fantasyNewsService;
          console.log('✅ Fantasy News Service connected');
          loadNewsData();
        } else {
          console.warn('⚠️ Fantasy News Service not found');
        }
      }

      async function loadNewsData() {
        if (!fantasyNewsApp) return;
        
        try {
          // Update injury watch in dashboard
          const injuryReports = fantasyNewsApp.getInjuryAlerts();
          updateInjuryWatch(injuryReports);
          
          // Update breaking news
          const breakingNews = fantasyNewsApp.getBreakingNews(3);
          updateBreakingNews(breakingNews);
          
        } catch (error) {
          console.error('❌ Error loading news data:', error);
        }
      }

      async function initializeRosterManager() {
        console.log('👥 Initializing Fantasy Roster Manager...');
        
        // Wait for fantasy roster manager to be available
        let attempts = 0;
        while (!window.fantasyRosterManager && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        if (window.fantasyRosterManager) {
          fantasyRosterApp = window.fantasyRosterManager;
          console.log('✅ Fantasy Roster Manager connected');
          
          // Display current user info
          const currentRoster = fantasyRosterApp.getUserRoster();
          if (currentRoster) {
            console.log(`👤 Loaded roster for: ${currentRoster.teamName} (${currentRoster.roster.length} players)`);
          }
        } else {
          console.warn('⚠️ Fantasy Roster Manager not found');
        }
      }

      async function loadDashboardData() {
        if (!fantasyApp || !fantasyRosterApp) return;
        
        try {
          console.log('🔄 Loading live fantasy data with user roster...');
          updateStatus('🔄 Loading optimal lineup from your roster...', 'loading');
          
          // Generate optimal lineup from user's actual roster
          const optimalLineupData = await fantasyRosterApp.generateOptimalLineup();
          if (optimalLineupData) {
            updateOptimalLineup(optimalLineupData);
          }
          
          // Load waiver wire targets
          const waiverTargets = await fantasyApp.getWaiverWireTargets();
          updateWaiverWire(waiverTargets);
          
          // Load NFL schedule for matchups
          const schedule = await fantasyApp.getNFLSchedule();
          updateMatchupInfo(schedule);
          
          updateStatus('✅ Live data loaded with your roster', 'success');
          
        } catch (error) {
          console.error('❌ Error loading live data:', error);
          updateStatus('❌ Error loading live data', 'error');
        }
      }

      function updateOptimalLineup(lineupData) {
        const lineupCard = document.querySelector('#dashboard .feature-card');
        if (!lineupCard || !lineupData.lineup.length) return;
        
        const currentRoster = fantasyRosterApp.getUserRoster();
        
        let lineupHTML = `<h4>${currentRoster.teamName} - Optimal Lineup</h4>`;
        
        // Group players by lineup position
        const positions = ['QB', 'RB', 'WR', 'TE', 'FLEX', 'K', 'DEF'];
        
        positions.forEach(position => {
          const positionPlayers = lineupData.lineup.filter(p => p.lineupPosition === position);
          
          if (position === 'RB' || position === 'WR') {
            // Handle multiple RB/WR positions
            positionPlayers.forEach((player, index) => {
              const posLabel = `${position}${index + 1}`;
              lineupHTML += `<p><strong>${posLabel}:</strong> ${player.name} (${player.team}) - ${player.projection} pts</p>`;
            });
          } else if (positionPlayers.length > 0) {
            const player = positionPlayers[0];
            lineupHTML += `<p><strong>${position}:</strong> ${player.name} (${player.team}) - ${player.projection} pts</p>`;
          }
        });
        
        lineupHTML += `<p style="color: #4ade80; font-weight: bold">Projected Total: ${lineupData.totalProjection.toFixed(1)} points</p>`;
        lineupHTML += `<p style="color: #fbbf24; font-size: 0.9em">Confidence: ${lineupData.confidence}</p>`;
        
        // Add top recommendation if available
        if (lineupData.recommendations.length > 0) {
          const topRec = lineupData.recommendations[0];
          lineupHTML += `<p style="color: #60a5fa; font-size: 0.9em">💡 ${topRec.message}</p>`;
        }
        
        lineupCard.innerHTML = lineupHTML;
      }

      function updateInjuryWatch(injuries) {
        const injuryCard = document.querySelector('#dashboard .feature-card:nth-child(3)');
        if (!injuryCard) return;
        
        let injuryHTML = '<h4>Injury Watch (Live Data)</h4>';
        
        if (injuries.length > 0) {
          injuries.slice(0, 4).forEach(injury => {
            const icon = fantasyNewsApp.getStatusIcon(injury.gameStatus);
            injuryHTML += `<p>${icon} ${injury.player} (${injury.team}) - ${injury.injury}</p>`;
          });
        } else {
          injuryHTML += '<p>✅ No major injury concerns this week</p>';
          injuryHTML += '<p>📅 Monitor practice reports Wednesday</p>';
        }
        
        injuryCard.innerHTML = injuryHTML;
      }

      function updateBreakingNews(news) {
        const outlookCard = document.querySelector('#dashboard .feature-card:nth-child(4)');
        if (!outlookCard || !news.length) return;
        
        let newsHTML = '<h4>Breaking Fantasy News</h4>';
        
        news.forEach(item => {
          const timeAgo = fantasyNewsApp.formatTimeAgo(item.timestamp);
          newsHTML += `<p>📰 ${item.headline} (${timeAgo})</p>`;
        });
        
        if (news.length === 0) {
          newsHTML += '<p>📈 No breaking news - check back later</p>';
        }
        
        outlookCard.innerHTML = newsHTML;
      }

      function updateWaiverWire(targets) {
        const waiverSection = document.getElementById('waivers');
        if (!waiverSection || !targets.length) return;
        
        const topTargetsCard = waiverSection.querySelector('.feature-card');
        if (!topTargetsCard) return;
        
        let waiverHTML = '<h4>Top Waiver Targets (Live Data)</h4>';
        targets.slice(0, 5).forEach((target, index) => {
          waiverHTML += `<p>${index + 1}. ${target.name} (${target.position}, ${target.team}) - ${target.score}% opportunity score</p>`;
        });
        
        topTargetsCard.innerHTML = waiverHTML;
      }

      function updateMatchupInfo(schedule) {
        const matchupCard = document.querySelector('#dashboard .feature-card:nth-child(2)');
        if (!matchupCard || !schedule.length) return;
        
        let matchupHTML = '<h4>This Week\'s Matchups (Live Data)</h4>';
        schedule.slice(0, 4).forEach(game => {
          const gameTime = new Date(game.date).toLocaleDateString();
          matchupHTML += `<p>${game.awayTeam} @ ${game.homeTeam} (${gameTime})</p>`;
        });
        
        matchupCard.innerHTML = matchupHTML;
      }

      function updateStatus(message, type = 'info') {
        const statusElement = document.getElementById('status');
        if (!statusElement) return;
        
        statusElement.textContent = message;
        statusElement.className = 'status';
        
        // Add type-specific styling
        if (type === 'loading') {
          statusElement.style.color = '#fbbf24';
        } else if (type === 'success') {
          statusElement.style.color = '#4ade80';
        } else if (type === 'error') {
          statusElement.style.color = '#f87171';
        }
      }

      function showSection(sectionName) {
        console.log("Showing section:", sectionName);

        // Hide all content sections
        var sections = document.querySelectorAll(".content");
        for (var i = 0; i < sections.length; i++) {
          sections[i].classList.remove("active");
        }

        // Show selected section
        var targetSection = document.getElementById(sectionName);
        if (targetSection) {
          targetSection.classList.add("active");
          updateStatus("Showing " + sectionName + " section ✅");

          // Load section-specific data
          loadSectionData(sectionName);

          // Scroll to content
          targetSection.scrollIntoView({ behavior: "smooth" });
        } else {
          updateStatus("Error: " + sectionName + " section not found ❌", 'error');
        }
      }

      async function loadSectionData(sectionName) {
        if (!fantasyApp || !fantasyRosterApp) return;
        
        try {
          switch (sectionName) {
            case 'lineup':
              await loadLineupOptimizerData();
              break;
            case 'projections':
              await loadProjectionsData();
              break;
            case 'waivers':
              await loadWaiverData();
              break;
            case 'roster':
              await loadRosterData();
              break;
            case 'trades':
              await loadTradeData();
              break;
            case 'settings':
              await loadSettingsData();
              break;
          }
        } catch (error) {
          console.error(`Error loading ${sectionName} data:`, error);
        }
      }

      async function loadLineupOptimizerData() {
        const lineupSection = document.getElementById('lineup');
        if (!lineupSection) return;
        
        const featureCards = lineupSection.querySelectorAll('.feature-card');
        
        // Get optimal lineup and analysis
        const optimalLineupData = await fantasyRosterApp.generateOptimalLineup();
        const sitStartRecommendations = fantasyRosterApp.getSitStartRecommendations();
        const rosterAnalysis = fantasyRosterApp.getRosterAnalysis();
        const currentRoster = fantasyRosterApp.getUserRoster();
        
        // Update optimization results
        if (featureCards[0] && optimalLineupData) {
          let optimizationHTML = '<h4>Your Lineup Analysis</h4>';
          optimizationHTML += `<p>Total Projected Points: <strong>${optimalLineupData.totalProjection.toFixed(1)}</strong></p>`;
          optimizationHTML += `<p>Lineup Confidence: <strong>${optimalLineupData.confidence}</strong></p>`;
          optimizationHTML += `<p>Team Record: <strong>${currentRoster.record.wins}-${currentRoster.record.losses}</strong></p>`;
          optimizationHTML += `<p>Playoff Seed: <strong>#${currentRoster.playoffSeed}</strong></p>`;
          featureCards[0].innerHTML = optimizationHTML;
        }
        
        // Update suggested changes
        if (featureCards[1] && optimalLineupData.recommendations.length > 0) {
          let changesHTML = '<h4>Lineup Recommendations</h4>';
          optimalLineupData.recommendations.slice(0, 3).forEach((rec, index) => {
            changesHTML += `<p>${index + 1}. ${rec.message}</p>`;
            if (rec.impact) {
              changesHTML += `<p style="color: #4ade80; font-size: 0.9em">   Impact: ${rec.impact}</p>`;
            }
          });
          featureCards[1].innerHTML = changesHTML;
        }
        
        // Update risk analysis
        if (featureCards[2]) {
          let riskHTML = '<h4>Roster Risk Analysis</h4>';
          
          // Count injured players
          const injuredPlayers = currentRoster.roster.filter(p => 
            p.injury && p.injury !== 'Healthy'
          );
          
          if (injuredPlayers.length > 0) {
            riskHTML += `<p style="color: #f97316">⚠️ ${injuredPlayers.length} players with injury concerns</p>`;
            injuredPlayers.slice(0, 2).forEach(player => {
              riskHTML += `<p style="font-size: 0.9em">   ${player.name} (${player.injury})</p>`;
            });
          } else {
            riskHTML += '<p style="color: #4ade80">✅ No injury concerns this week</p>';
          }
          
          // Add depth analysis
          if (rosterAnalysis) {
            if (rosterAnalysis.weaknesses.length > 0) {
              riskHTML += `<p style="color: #fbbf24">📊 Depth Concerns: ${rosterAnalysis.weaknesses[0]}</p>`;
            }
          }
          
          featureCards[2].innerHTML = riskHTML;
        }
        
        // Update matchup grades with actual roster
        if (featureCards[3]) {
          let matchupHTML = '<h4>Your Players This Week</h4>';
          
          const starters = fantasyRosterApp.getStartingLineup();
          const positionGroups = {
            QB: starters.filter(p => p.position === 'QB'),
            RB: starters.filter(p => p.position === 'RB'),
            WR: starters.filter(p => p.position === 'WR'),
            TE: starters.filter(p => p.position === 'TE')
          };
          
          Object.entries(positionGroups).forEach(([pos, players]) => {
            if (players.length > 0) {
              const avgProjection = players.reduce((sum, p) => sum + fantasyRosterApp.getStaticProjection(p), 0) / players.length;
              let grade = avgProjection >= 18 ? 'A+' : avgProjection >= 15 ? 'A' : avgProjection >= 12 ? 'B+' : avgProjection >= 10 ? 'B' : 'C';
              matchupHTML += `<p><strong>${pos}:</strong> ${grade} (${players.map(p => p.name.split(' ')[1]).join(', ')})</p>`;
            }
          });
          
          featureCards[3].innerHTML = matchupHTML;
        }
        
        console.log('✅ Lineup optimizer data loaded with user roster');
      }

      async function loadRosterData() {
        if (!fantasyRosterApp) return;
        
        const currentRoster = fantasyRosterApp.getUserRoster();
        const optimalLineupData = await fantasyRosterApp.generateOptimalLineup();
        const sitStartRecommendations = fantasyRosterApp.getSitStartRecommendations();
        const rosterAnalysis = fantasyRosterApp.getRosterAnalysis();
        
        // Update starting lineup display
        const startingLineupDiv = document.getElementById('starting-lineup-display');
        if (startingLineupDiv && optimalLineupData) {
          let lineupHTML = '';
          
          optimalLineupData.lineup.forEach(player => {
            const statusIcon = player.injury !== 'Healthy' ? '🟡' : '✅';
            lineupHTML += `<p>${statusIcon} <strong>${player.lineupPosition}:</strong> ${player.name} (${player.team}) - ${player.projection} pts</p>`;
          });
          
          lineupHTML += `<hr><p style="color: #4ade80; font-weight: bold">Total: ${optimalLineupData.totalProjection.toFixed(1)} points</p>`;
          startingLineupDiv.innerHTML = lineupHTML;
        }
        
        // Update bench players display
        const benchDiv = document.getElementById('bench-players-display');
        if (benchDiv) {
          const benchPlayers = fantasyRosterApp.getBench();
          let benchHTML = '';
          
          benchPlayers.forEach(player => {
            const projection = fantasyRosterApp.getStaticProjection(player);
            const statusIcon = player.injury !== 'Healthy' ? '🟡' : '✅';
            benchHTML += `<p>${statusIcon} <strong>${player.position}:</strong> ${player.name} (${player.team}) - ${projection} pts</p>`;
          });
          
          if (benchPlayers.length === 0) {
            benchHTML = '<p>No bench players</p>';
          }
          
          benchDiv.innerHTML = benchHTML;
        }
        
        // Update roster stats
        const statsDiv = document.getElementById('roster-stats-display');
        if (statsDiv && currentRoster) {
          let statsHTML = `<p><strong>Team:</strong> ${currentRoster.teamName}</p>`;
          statsHTML += `<p><strong>Record:</strong> ${currentRoster.record.wins}-${currentRoster.record.losses}</p>`;
          statsHTML += `<p><strong>Points For:</strong> ${currentRoster.pointsFor}</p>`;
          statsHTML += `<p><strong>Playoff Seed:</strong> #${currentRoster.playoffSeed}</p>`;
          statsHTML += `<p><strong>Draft Position:</strong> ${currentRoster.draftPosition}</p>`;
          
          // Add strengths/weaknesses
          if (rosterAnalysis) {
            if (rosterAnalysis.strengths.length > 0) {
              statsHTML += `<p style="color: #4ade80">💪 ${rosterAnalysis.strengths[0]}</p>`;
            }
            if (rosterAnalysis.weaknesses.length > 0) {
              statsHTML += `<p style="color: #f97316">⚠️ ${rosterAnalysis.weaknesses[0]}</p>`;
            }
          }
          
          statsDiv.innerHTML = statsHTML;
        }
        
        // Update sit/start recommendations
        const sitStartDiv = document.getElementById('sit-start-display');
        if (sitStartDiv) {
          let recommendationsHTML = '';
          
          if (optimalLineupData && optimalLineupData.recommendations.length > 0) {
            optimalLineupData.recommendations.forEach((rec, index) => {
              recommendationsHTML += `<p><strong>${index + 1}.</strong> ${rec.message}</p>`;
              if (rec.impact) {
                recommendationsHTML += `<p style="color: #4ade80; font-size: 0.9em">   ${rec.impact}</p>`;
              }
            });
          } else {
            recommendationsHTML = '<p>✅ Your current lineup is optimal!</p>';
          }
          
          // Add position-specific recommendations
          sitStartRecommendations.slice(0, 2).forEach(posRec => {
            recommendationsHTML += `<p><strong>${posRec.position}:</strong> Start ${posRec.start.name}</p>`;
          });
          
          sitStartDiv.innerHTML = recommendationsHTML;
        }
        
        console.log('✅ Roster data loaded successfully');
      }

      async function loadSettingsData() {
        if (!fantasyRosterApp) return;
        
        const leagueSettings = fantasyRosterApp.leagueSettings;
        const currentRoster = fantasyRosterApp.getUserRoster();
        
        // Update league settings display
        const leagueSettingsDiv = document.getElementById('league-settings-display');
        if (leagueSettingsDiv) {
          let settingsHTML = '<h4>League Settings</h4>';
          settingsHTML += `<p><strong>Scoring:</strong> ${leagueSettings.scoringType}</p>`;
          settingsHTML += `<p><strong>Teams:</strong> 12 teams</p>`;
          settingsHTML += `<p><strong>Roster Size:</strong> ${leagueSettings.rosterSize} players</p>`;
          
          // Build starting lineup format
          const lineup = Object.entries(leagueSettings.startingLineup)
            .map(([pos, count]) => `${count} ${pos}`)
            .join(', ');
          settingsHTML += `<p><strong>Starting:</strong> ${lineup}</p>`;
          settingsHTML += `<p><strong>Bench:</strong> ${leagueSettings.benchSize} players</p>`;
          
          leagueSettingsDiv.innerHTML = settingsHTML;
        }
        
        // Update waiver settings display
        const waiverSettingsDiv = document.getElementById('waiver-settings-display');
        if (waiverSettingsDiv) {
          let waiverHTML = '<h4>Waiver Settings</h4>';
          waiverHTML += '<p><strong>Type:</strong> FAAB ($100 budget)</p>';
          waiverHTML += '<p><strong>Period:</strong> 2 days</p>';
          waiverHTML += '<p><strong>Resets:</strong> Weekly</p>';
          waiverHTML += '<p><strong>Priority:</strong> Inverse standings</p>';
          
          waiverSettingsDiv.innerHTML = waiverHTML;
        }
        
        // Update playoff settings display
        const playoffSettingsDiv = document.getElementById('playoff-settings-display');
        if (playoffSettingsDiv && currentRoster) {
          let playoffHTML = '<h4>Playoff Settings</h4>';
          playoffHTML += '<p><strong>Teams:</strong> 6 make playoffs</p>';
          playoffHTML += '<p><strong>Weeks:</strong> 15-17</p>';
          playoffHTML += '<p><strong>Championship:</strong> Week 17</p>';
          playoffHTML += `<p style="color: #4ade80"><strong>Your Seed:</strong> #${currentRoster.playoffSeed}</p>`;
          
          playoffSettingsDiv.innerHTML = playoffHTML;
        }
        
        console.log('✅ Settings data loaded');
      }

      async function loadProjectionsData() {
        const projectionsSection = document.getElementById('projections');
        if (!projectionsSection) return;
        
        const projections = await fantasyApp.getPlayerProjections();
        const featureCards = projectionsSection.querySelectorAll('.feature-card');
        
        // Update QB projections
        if (featureCards[0]) {
          const qbs = projections.filter(p => p.position === 'QB').slice(0, 4);
          let qbHTML = '<h4>Top QB Projections (Live)</h4>';
          qbs.forEach(qb => {
            qbHTML += `<p>${qb.name} (${qb.team}): ${qb.projection} pts</p>`;
          });
          featureCards[0].innerHTML = qbHTML;
        }
        
        // Update RB projections
        if (featureCards[1]) {
          const rbs = projections.filter(p => p.position === 'RB').slice(0, 4);
          let rbHTML = '<h4>Top RB Projections (Live)</h4>';
          rbs.forEach(rb => {
            rbHTML += `<p>${rb.name} (${rb.team}): ${rb.projection} pts</p>`;
          });
          featureCards[1].innerHTML = rbHTML;
        }
        
        // Update WR projections
        if (featureCards[2]) {
          const wrs = projections.filter(p => p.position === 'WR').slice(0, 4);
          let wrHTML = '<h4>Top WR Projections (Live)</h4>';
          wrs.forEach(wr => {
            wrHTML += `<p>${wr.name} (${wr.team}): ${wr.projection} pts</p>`;
          });
          featureCards[2].innerHTML = wrHTML;
        }
        
        // Update TE projections
        if (featureCards[3]) {
          const tes = projections.filter(p => p.position === 'TE').slice(0, 4);
          let teHTML = '<h4>Top TE Projections (Live)</h4>';
          tes.forEach(te => {
            teHTML += `<p>${te.name} (${te.team}): ${te.projection} pts</p>`;
          });
          featureCards[3].innerHTML = teHTML;
        }
      }

      async function loadWaiverData() {
        const waiverTargets = await fantasyApp.getWaiverWireTargets();
        const waiverSection = document.getElementById('waivers');
        if (!waiverSection) return;
        
        const featureCards = waiverSection.querySelectorAll('.feature-card');
        
        // Update breakout candidates
        if (featureCards[1]) {
          const breakouts = waiverTargets.filter(t => t.score > 85).slice(0, 3);
          let breakoutHTML = '<h4>Breakout Candidates (Live)</h4>';
          breakouts.forEach(player => {
            breakoutHTML += `<p>${player.name} (${player.position}, ${player.team}) - ${player.reasoning}</p>`;
          });
          featureCards[1].innerHTML = breakoutHTML;
        }

        // Update injury replacements with live injury data
        if (featureCards[2] && fantasyNewsApp) {
          const injuries = fantasyNewsApp.getInjuryAlerts();
          const waiverNews = fantasyNewsApp.getWaiverWireNews();
          
          let injuryHTML = '<h4>Injury Replacements (Live)</h4>';
          
          injuries.slice(0, 2).forEach(injury => {
            const icon = fantasyNewsApp.getStatusIcon(injury.gameStatus);
            injuryHTML += `<p>${icon} Monitor ${injury.player} (${injury.injury})</p>`;
          });
          
          if (waiverNews.length > 0) {
            injuryHTML += `<p>📈 ${waiverNews[0].headline}</p>`;
          }
          
          featureCards[2].innerHTML = injuryHTML;
        }
        
        // Update trending up
        if (featureCards[3]) {
          const trending = waiverTargets.slice(0, 3);
          let trendHTML = '<h4>Trending Up (Live)</h4>';
          trending.forEach(player => {
            trendHTML += `<p>${player.name} (${player.position}, ${player.team}) ${player.trending}</p>`;
          });
          featureCards[3].innerHTML = trendHTML;
        }
      }

      async function loadTradeData() {
        const tradesSection = document.getElementById('trades');
        if (!tradesSection || !fantasyRosterApp) return;
        
        const featureCards = tradesSection.querySelectorAll('.feature-card');
        const currentRoster = fantasyRosterApp.getUserRoster();
        const starters = fantasyRosterApp.getStartingLineup();
        
        // Update trade opportunities with mock suggestions
        if (featureCards[0] && starters.length > 0) {
          let opportunitiesHTML = '<h4>Trade Opportunities</h4>';
          opportunitiesHTML += '<p><em>Analyze trades based on your roster:</em></p>';
          
          // Find a player to potentially trade
          const tradeablePlayer = starters.find(p => p.position === 'WR' || p.position === 'RB');
          if (tradeablePlayer) {
            const projection = fantasyRosterApp.getStaticProjection(tradeablePlayer);
            opportunitiesHTML += `<p>Consider trading ${tradeablePlayer.name}</p>`;
            opportunitiesHTML += `<p style="color: #fbbf24">Current Value: ${projection} pts/week</p>`;
          }
          
          opportunitiesHTML += '<p>💡 Look for 2-for-1 upgrades</p>';
          opportunitiesHTML += '<p>🎯 Target playoff schedule matchups</p>';
          
          featureCards[0].innerHTML = opportunitiesHTML;
        }
        
        // Update player values from user roster
        if (featureCards[1] && starters.length > 0) {
          let valuesHTML = '<h4>Your Player Values</h4>';
          
          const topPlayers = starters
            .sort((a, b) => fantasyRosterApp.getStaticProjection(b) - fantasyRosterApp.getStaticProjection(a))
            .slice(0, 4);
            
          topPlayers.forEach(player => {
            const projection = fantasyRosterApp.getStaticProjection(player);
            const tradeValue = Math.round(projection * 1.2 * 10) / 10;
            valuesHTML += `<p>${player.name}: ${tradeValue} trade points</p>`;
          });
          
          featureCards[1].innerHTML = valuesHTML;
        }
        
        // Update trade calculator with user context
        if (featureCards[2]) {
          let calculatorHTML = '<h4>Trade Calculator</h4>';
          calculatorHTML += `<p><strong>Your Team:</strong> ${currentRoster.teamName}</p>`;
          calculatorHTML += `<p><strong>Record:</strong> ${currentRoster.record.wins}-${currentRoster.record.losses}</p>`;
          calculatorHTML += '<p>📊 Rest-of-season projections</p>';
          calculatorHTML += '<p>📅 Playoff schedule analysis</p>';
          calculatorHTML += '<p>⚖️ Position scarcity factors</p>';
          
          featureCards[2].innerHTML = calculatorHTML;
        }
        
        // Update trade tips with relevant news and roster insights
        if (featureCards[3]) {
          let tipsHTML = '<h4>Trade Tips (Your Team)</h4>';
          
          // Add injury-based trade advice from user roster
          const injuredPlayers = currentRoster.roster.filter(p => p.injury && p.injury !== 'Healthy');
          if (injuredPlayers.length > 0) {
            const injuredPlayer = injuredPlayers[0];
            tipsHTML += `<p>💡 Monitor ${injuredPlayer.name} (${injuredPlayer.injury})</p>`;
          }
          
          // Add roster-specific advice
          if (currentRoster.playoffSeed <= 4) {
            tipsHTML += '<p>🎯 You\'re in playoff position - trade for consistency</p>';
          } else {
            tipsHTML += '<p>⚡ Take calculated risks for upside</p>';
          }
          
          // Add news-based insights if available
          if (fantasyNewsApp) {
            const tradeNews = fantasyNewsApp.getTradeNews();
            if (tradeNews.length > 0) {
              tipsHTML += `<p>📰 ${tradeNews[0].headline}</p>`;
            }
          }
          
          // Default trade tips
          tipsHTML += '<p>📈 Consider playoff schedules for trade timing</p>';
          tipsHTML += '<p>⏰ Trade deadline approaches - act quickly</p>';
          
          featureCards[3].innerHTML = tipsHTML;
        }
        
        console.log('✅ Trade data loaded with user roster context');
      }

      function forceLoadRosterData() {
        // Force load roster data immediately
        const rosterManager = window.fantasyRosterManager;
        if (!rosterManager) return;

        const roster = rosterManager.getUserRoster();
        if (!roster) return;

        console.log(`🎯 Loading data for: ${roster.teamName}`);

        // Update dashboard immediately with roster data
        const lineupCard = document.querySelector('#dashboard .feature-card');
        if (lineupCard) {
          let html = `<h4>${roster.teamName} - Your Team</h4>`;
          html += `<p><strong>Record:</strong> ${roster.record.wins}-${roster.record.losses}</p>`;
          html += `<p><strong>Playoff Seed:</strong> #${roster.playoffSeed}</p>`;
          html += `<p><strong>Points For:</strong> ${roster.pointsFor}</p>`;
          
          // Show starting lineup
          const starters = roster.roster.filter(p => p.status === 'starter' || p.status === 'flex');
          html += `<p><strong>Starters:</strong></p>`;
          starters.slice(0, 4).forEach(player => {
            html += `<p>• ${player.name} (${player.position}, ${player.team})</p>`;
          });
          
          lineupCard.innerHTML = html;
        }

        // Update injury watch with real data
        const injuryCard = document.querySelector('#dashboard .feature-card:nth-child(3)');
        if (injuryCard) {
          const injured = roster.roster.filter(p => p.injury && p.injury !== 'Healthy');
          let injuryHTML = '<h4>Injury Watch (Your Players)</h4>';
          
          if (injured.length > 0) {
            injured.forEach(player => {
              injuryHTML += `<p>⚠️ ${player.name} (${player.injury})</p>`;
            });
          } else {
            injuryHTML += '<p>✅ No injury concerns with your players</p>';
          }
          
          injuryCard.innerHTML = injuryHTML;
        }
      }

      function loadFallbackData() {
        console.log('📝 No roster found - showing empty state');
        
        // Update dashboard with no-roster message
        const lineupCard = document.querySelector('#dashboard .feature-card');
        if (lineupCard) {
          let html = '<h4>No Roster Found</h4>';
          html += '<p style="color: #fbbf24;">⚠️ You need to build your roster first!</p>';
          html += '<p>Click the <strong>"👥 Build Your Roster"</strong> button above to:</p>';
          html += '<p>• Add your fantasy players</p>';
          html += '<p>• Set your team name and record</p>';
          html += '<p>• Get personalized recommendations</p>';
          html += '<br>';
          html += '<a href="roster-builder.html" style="background: #667eea; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Build Roster Now</a>';
          
          lineupCard.innerHTML = html;
        }

        // Update other cards with empty messages
        const matchupCard = document.querySelector('#dashboard .feature-card:nth-child(2)');
        if (matchupCard) {
          matchupCard.innerHTML = '<h4>This Week\'s Matchups</h4><p>Add players to see matchup analysis</p>';
        }

        const injuryCard = document.querySelector('#dashboard .feature-card:nth-child(3)');
        if (injuryCard) {
          injuryCard.innerHTML = '<h4>Injury Watch</h4><p>Add players to monitor injury status</p>';
        }

        const newsCard = document.querySelector('#dashboard .feature-card:nth-child(4)');
        if (newsCard) {
          newsCard.innerHTML = '<h4>Breaking Fantasy News</h4><p>Add players to get personalized news</p>';
        }

        // Update status
        const statusElement = document.getElementById('status');
        if (statusElement) {
          statusElement.textContent = '⚠️ No roster found - Build your roster to get started';
          statusElement.style.color = '#fbbf24';
        }
      }

      // Show dashboard by default and force load data immediately
      setTimeout(function () {
        showSection("dashboard");
        
        // Force immediate data loading for testing
        if (window.fantasyRosterManager) {
          console.log('🔧 Force loading roster data...');
          forceLoadRosterData();
        } else {
          console.warn('⚠️ Roster manager not available, loading fallback');
          loadFallbackData();
        }
      }, 500);

      // Add click feedback
      var cards = document.querySelectorAll(".nav-card");
      for (var i = 0; i < cards.length; i++) {
        cards[i].addEventListener("click", function () {
          var card = this;
          card.style.transform = "translateY(-5px) scale(0.98)";
          setTimeout(function () {
            card.style.transform = "translateY(-5px) scale(1)";
          }, 150);
        });
      }

      // Debug functions for testing
      window.debugFantasyHub = function() {
        console.log('🔍 Debug Fantasy Hub:');
        console.log('fantasyRosterManager:', !!window.fantasyRosterManager);
        console.log('fantasyDataService:', !!window.fantasyDataService);
        console.log('fantasyNewsService:', !!window.fantasyNewsService);
        
        if (window.fantasyRosterManager) {
          const roster = window.fantasyRosterManager.getUserRoster();
          console.log('Current roster:', roster?.teamName || 'None');
          console.log('Roster players:', roster?.roster?.length || 0);
        }
        
        // Force reload data
        console.log('🔄 Force reloading data...');
        if (window.fantasyRosterManager) {
          forceLoadRosterData();
        } else {
          loadFallbackData();
        }
      };

      // Clear any old demo data on first load
      if (localStorage.getItem('clearDemoData') !== 'true') {
        console.log('🧹 Clearing any old demo data...');
        localStorage.removeItem('userFantasyRoster');
        localStorage.setItem('clearDemoData', 'true');
      }

      // Auto-debug after 2 seconds
      setTimeout(() => {
        console.log('🚀 Auto-debugging Fantasy Hub...');
        window.debugFantasyHub();
      }, 2000);
    </script>
  </body>
</html>
